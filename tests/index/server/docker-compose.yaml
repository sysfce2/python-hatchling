services:
  devpi:
    container_name: hatch-devpi
    build:
      context: devpi
    ports:
    - "3141:3141"
    environment:
    - DEVPI_INDEX_NAME
    - DEVPI_USERNAME
    - DEVPI_PASSWORD
    healthcheck:
      test: [ "CMD", "python", "-c", "import urllib.request; urllib.request.urlopen('http://localhost:3141')" ]
      interval: 2s
      timeout: 5s
      retries: 30
      start_period: 10s

  nginx:
    container_name: hatch-nginx
    image: nginx:alpine
    ports:
    - "8080:80"
    - "8443:443"
    volumes:
    - ./nginx:/etc/nginx
    depends_on:
      devpi:
        condition: service_healthy